<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ULTRA Production Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- âœ… Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    margin:0;
    padding:15px;
}
h1{text-align:center;}

.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.card{
    background:#fff;
    border-radius:12px;
    padding:15px;
    margin:12px 0;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
    position:relative;
}

.rank{
    background:#ddd;
    border-radius:6px;
    padding:4px 8px;
    font-weight:bold;
}

.blue{background:#2979ff;color:white;padding:4px 8px;border-radius:6px;}
.greenbg{background:#43a047;color:white;padding:4px 8px;border-radius:6px;}
.redbg{background:#e53935;color:white;padding:4px 8px;border-radius:6px;}

.input-row{margin-top:6px;display:flex;gap:8px;align-items:center;}

input{
    width:85px;
    padding:6px;
}

button{
    padding:6px 10px;
    border-radius:6px;
    cursor:pointer;
}

progress{
    width:100%;
    height:18px;
    margin:6px 0;
}

.green{color:#00c853;font-weight:bold;}
.red{color:#ff5252;font-weight:bold;}

.timestamp{
    position:absolute;
    font-size:11px;
    color:#777;
    right:10px;
    top:8px;
}

.lock{
    text-align:center;
    margin-bottom:20px;
}

.dark{
    background:#121212;
    color:#eee;
}
.dark .card{background:#1e1e1e;}
.dark input, .dark button{
    background:#333;
    color:#fff;
    border-color:#555;
}
.dark .rank{background:#333;color:white;}

.footer{
    text-align:center;
    color:#777;
}

/* ========= CHRISTMAS THEME ========= */

#snow-container{
    pointer-events:none;
    position:fixed;
    inset:0;
    overflow:hidden;
    z-index:0;
}

flake{
    position:absolute;
    color:white;
    user-select:none;
    animation:fall linear forwards;
}

@keyframes fall{
    from{ transform:translateY(-10px); opacity:1; }
    to{ transform:translateY(110vh); opacity:0; }
}

#snow-ground{
    pointer-events:none;
    position:fixed;
    bottom:0;
    left:0;
    width:100vw;
    height:2px;
    z-index:1;
    transition:height 2s ease;
}

.snow-layer{
    position:absolute;
    width:200%;
    height:100%;
    border-radius:50%;
    filter: blur(2px);
}

.layer1{
    background:linear-gradient(90deg,#fff,#f5f5f5,#fff);
    animation:wave 30s linear infinite;
}
.layer2{
    bottom:-4px;
    background:linear-gradient(90deg,#e6e6e6,#dadada,#e6e6e6);
    animation:wave 45s linear infinite reverse;
}
.layer3{
    bottom:-7px;
    background:linear-gradient(90deg,#d6d6d6,#cfcfcf,#d6d6d6);
    animation:wave 60s linear infinite;
}

@keyframes wave{
    from{transform:translateX(0);}
    to{transform:translateX(-50%);}
}
</style>
</head>

<body>

<div id="snow-container"></div>

<div id="snow-ground">
    <div class="snow-layer layer1"></div>
    <div class="snow-layer layer2"></div>
    <div class="snow-layer layer3"></div>
</div>

<div class="header">
    <h1>ULTRA Production Leaderboard</h1>
    <button onclick="toggleDark()">ðŸŒ™</button>
</div>

<div class="lock">
    <h3>Enter PIN</h3>
    <input type="password" id="pinInput" maxlength="4">
    <button onclick="unlock()">Unlock</button>
</div>

<div id="board"></div>

<div class="footer">
    Target: <b>4,000 parts/hr</b> â€¢ Day: <b>36,000 parts</b>
</div>

<script>
/* ===== FIREBASE ===== */
firebase.initializeApp({
 apiKey: "AIzaSyBjEcJRy9C_WXJYhqLaBEZJ54ZwpEgH8qE",
 authDomain: "ultra-production-board.firebaseapp.com",
 projectId: "ultra-production-board",
 storageBucket: "ultra-production-board.firebasestorage.app",
 messagingSenderId: "1058393515822",
 appId: "1:1058393515822:web:a706cdbc8c02cc0c0e3cbf"
});

const db=firebase.database();

/* ===== SETTINGS ===== */
const PIN="0711";
const DAILY_TARGET=36000;
const TARGET_PPH=4000;
const SHIFT_START=9;
const SHIFT_HOURS=9;

const CHRISTMAS_MODE=true;   // <-- toggle here

const teams=["ULTRA1","ULTRA2","ULTRA3"];
let unlocked=false;

/* ===== UI ===== */

function toggleDark(){
   document.body.classList.toggle("dark");
}

function unlock(){
   if(pinInput.value===PIN){
      unlocked=true;
      document.querySelector(".lock").style.display="none";
      loadBoard();
   } else alert("Wrong PIN");
}

function loadBoard(){
   db.ref("production").on("value",snap=>{
       renderBoard(snap.val()||{});
   });
}

function save(name){
   db.ref("production/"+name).set({
       total : +document.getElementById(name).value,
       lastUpdated : new Date().toLocaleTimeString([],{
           hour:"2-digit",
           minute:"2-digit"
       })
   });
}

/* ===== RENDER ===== */

function renderBoard(data){

   const now=new Date();
   const start=new Date();
   start.setHours(SHIFT_START,0,0,0);

   let minsElapsed=Math.max(0,(now-start)/60000);
   let expectedSoFar=minsElapsed*(TARGET_PPH/60);

   const totals = teams.map(t=>({
      name:t,
      total:data[t]?.total||0,
      lastUpdated:data[t]?.lastUpdated||"--"
   })).sort((a,b)=>b.total-a.total);

   board.innerHTML="";

   totals.forEach((team,i)=>{

      let pct=Math.min(team.total/DAILY_TARGET*100,100);
      let diff=team.total-expectedSoFar;

      let mins=Math.abs(diff)/(TARGET_PPH/60);
      let h=Math.floor(mins/60);
      let m=Math.round(mins%60);

      let tText=h>0?`${h}h ${m}m`:`${m} min`;
      let status=diff>=0?"Ahead":"Behind";
      let c=diff>=0?"green":"red";

      board.innerHTML+=`
<div class="card">

<span class="rank">#${i+1}</span>

<span class="${team.name=="ULTRA1"?"blue":team.name=="ULTRA2"?"greenbg":"redbg"}">
${team.name}
</span>

<div class="input-row">
   <input id="${team.name}" type="number" value="${team.total}" ${unlocked?"":"disabled"}>
   <button onclick="save('${team.name}')" ${unlocked?"":"disabled"}>Update</button>
</div>

<progress value="${pct}" max="100"></progress>

<p class="${c}">
${status} ${Math.abs(Math.round(diff))} parts (${tText})
</p>

<p>${team.total} parts</p>

<p class="timestamp">
Last update: ${team.lastUpdated}
</p>

</div>
`;
   });
}

/* ===== CHRISTMAS ===== */

if(CHRISTMAS_MODE){

   function spawnSnow(){
      const f=document.createElement("flake");
      f.textContent="â„";
      f.style.left=Math.random()*100+"vw";
      f.style.fontSize=(10+Math.random()*10)+"px";
      f.style.animationDuration=(6+Math.random()*6)+"s";
      snow_container.appendChild(f);
      setTimeout(()=>f.remove(),10000);
   }

   setInterval(spawnSnow,300);

   function snowBuild(){
      const now=new Date();
      const start=new Date();
      start.setHours(SHIFT_START,0,0,0);

      let mins=Math.max(0,(now-start)/60000);
      let pct=Math.min(mins/(SHIFT_HOURS*60),1);

      snow_ground.style.height=(pct*10)+"vh";
   }

   const snow_container=document.getElementById("snow-container");
   const snow_ground=document.getElementById("snow-ground");

   setInterval(snowBuild,60000);
   snowBuild();
}

/* ===== DAILY RESET 7AM ===== */

function autoResetCheck(){

   const now=new Date();
   const today=now.toDateString();
   const already=localStorage.getItem("lastReset");

   if(now.getHours()===7 && now.getMinutes()===0 && already!==today){

      teams.forEach(team=>{
         db.ref("production/"+team).set({
           total:0,
           lastUpdated:"07:00"
         });
      });

      localStorage.setItem("lastReset",today);
      console.log("Daily reset complete");
   }
}

setInterval(autoResetCheck,60000);
autoResetCheck();
</script>

</body>
</html>
