<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ULTRA Production Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    margin:0;
    padding:15px;
}

h1{
    text-align:center;
}

.card{
    background:#fff;
    border-radius:12px;
    padding:15px;
    margin:12px 0;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.rank{
    background:#ddd;
    border-radius:6px;
    display:inline-block;
    padding:4px 8px;
    font-weight:bold;
    margin-right:10px;
}
progress {
    width:100%;
    height:18px;
    border-radius:10px;
    overflow:hidden;
}
progress::-webkit-progress-bar {
    background:#ddd;
    border-radius:10px;
}
progress::-webkit-progress-value {
    background:#2979ff;
    border-radius:10px;
}

input{
    width:80px;
    padding:6px;
    font-size:16px;
}

button {
    padding:10px 14px;
    border-radius:8px;
    border:1px solid #ccc;
    background:#fff;
    font-size:16px;
    cursor:pointer;
}

.lock{
    text-align:center;
    margin-bottom:20px;
}

.lock input{
    width:120px;
    text-align:center;
}

.green{
    color:#009900;
    font-weight:bold;
}

.red{
    color:#cc0000;
    font-weight:bold;
}

.footer{
    text-align:center;
    color:#555;
    margin-top:20px;
}
    .title {
    padding: 6px 10px;
    border-radius: 6px;
    color: white;
    display: inline-block;
}

.blue { background:#2979ff; }
.greenbg { background:#43a047; }
.redbg { background:#e53935; }

.timestamp {
    position: absolute;
    top:8px;
    right:10px;
    font-size:11px;
    color:#666;
}
    .input-row {
    display:flex;
    gap:10px;
    align-items:center;
}
    .card {
    transition:0.15s;
}
.card:hover {
    transform:scale(1.01);
}
    .title {
    padding:8px 14px;
}
    #tinsel-container {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100px; /* height of the tinsel effect */
  pointer-events: none; /* so it doesn't block clicks */
  z-index: 1000;
}

.tinsel {
  position: absolute;
  top: 0;
  width: 4px;
  height: 50px;
  background: linear-gradient(to bottom, #ff0000, #ffff00, #00ff00); /* festive colors */
  border-radius: 2px;
  animation: swing 2s ease-in-out infinite alternate;
}

@keyframes swing {
  0% { transform: rotate(-15deg); }
  50% { transform: rotate(15deg); }
  100% { transform: rotate(-15deg); }
}
</style>
</head>
    
<body>
    
<div id="tinsel-container"></div>
    
<h1>ULTRA Production Leaderboard</h1>

<div class="lock">
    <h3>Enter PIN to unlock editing</h3>
    <input type="password" id="pinInput" placeholder="4-digit PIN" maxlength="4">
    <button onclick="unlock()">Unlock</button>
</div>

<div id="board"></div>

<div class="footer">
Target: <b>4,000 parts/hr</b> â€¢ Daily target: <b>36,000 parts (9 hours)</b><br>
Live sync across devices enabled.
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ðŸ”¥ YOUR FIREBASE CONFIG */
const firebaseConfig = {
 apiKey: "AIzaSyBjEcJRy9C_WXJYhqLaBEZJ54ZwpEgH8qE",
 authDomain: "ultra-production-board.firebaseapp.com",
 projectId: "ultra-production-board",
 storageBucket: "ultra-production-board.firebasestorage.app",
 messagingSenderId: "1058393515822",
 appId: "1:1058393515822:web:a706cdbc8c02cc0c0e3cbf"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* SETTINGS */
const PIN = "0711";
const TARGET_HOURLY = 4000;
const DAILY_TARGET = 36000;

let unlocked = false;

const teams = [
 {name:"ULTRA1"},
 {name:"ULTRA2"},
 {name:"ULTRA3"}
];

/* UNLOCK */
function unlock(){
   if(document.getElementById("pinInput").value === PIN){
        unlocked = true;
        document.querySelector(".lock").style.display="none";
        loadBoard();
   } else {
        alert("Incorrect PIN");
   }
}

/* LOAD & LIVE SYNC */
function loadBoard(){
   const ref = db.ref("production");
   ref.on("value", snapshot=>{
      const data = snapshot.val() || {};
      renderBoard(data);
   });
}

/* UPDATE DATA */
    function updateTeam(name,value){

    const nowTime = new Date().toLocaleTimeString([], {
        hour: "2-digit",
        minute: "2-digit"
    });

    db.ref("production/"+name).set({
        total: Number(value),
        lastUpdated: nowTime
    });
 }
    
/* RENDER */
function renderBoard(data){

   let totals = teams.map(t=>{
        return {name:t.name, total:data[t.name]?.total || 0};
   });

   totals.sort((a,b)=>b.total-a.total);

   let html="";

   totals.forEach((team,idx)=>{
    let percent = Math.min(team.total / DAILY_TARGET *100,100);
    // Calculate expected output based on time of day
const SHIFT_START_HOUR = 8;

const now = new Date();
const shiftStart = new Date();
shiftStart.setHours(SHIFT_START_HOUR,0,0,0);

// Hours worked since 09:00
let elapsedHours = (now - shiftStart) / (1000*60*60);

// Prevent negative numbers before shift starts
elapsedHours = Math.max(0, Math.min(elapsedHours, 9));

// Expected parts so far
let expected = Math.floor(elapsedHours * 4000);

// Difference vs expected at current time
let diff = team.total - expected;
    let diffClass = diff>=0?"green":"red";

    const partsPerMinute = 4000 / 60;
    const minutes = Math.abs(diff) / partsPerMinute;

    let timeLabel = "";

    if(minutes >= 60){
        let h = Math.floor(minutes / 60);
        let m = Math.round(minutes % 60);
        timeLabel = `${h}h ${m}m`;
    } else {
        timeLabel = `${Math.round(minutes)} min`;
    }

    let direction = diff >= 0 ? "Ahead" : "Behind";

    html+=`
    <div class="card" style="position:relative;">
    <div>
        <span class="rank">#${idx+1}</span>
        <span class="title ${team.name==="ULTRA1"?"blue":team.name==="ULTRA2"?"greenbg":"redbg"}">
            ${team.name}
        </span>
    </div>

<div class="input-row">
    <input type="number" id="${team.name}" value="${team.total}" ${unlocked?"":"disabled"}>
    <button onclick="save('${team.name}')" ${unlocked?"":"disabled"}>Update</button>
</div>
    
        <p class="${diffClass}">
            ${direction} by ${Math.abs(diff)} parts<br>
            (â‰ˆ ${timeLabel} ${direction.toLowerCase()})
        </p>
        
<p class="timestamp">
    Last update: ${data[team.name]?.lastUpdated || "--"}
</p>

        <progress value="${percent}" max="100"></progress>

        <p>${team.total} parts</p>
    </div>
    `;
});
    
   document.getElementById("board").innerHTML = html;
}

function save(name){
    let val = document.getElementById(name).value;
    updateTeam(name,val);
}
</script>
    
<script>
const tinselContainer = document.getElementById('tinsel-container');
const tinselCount = 30; // number of tinsel strands

for (let i = 0; i < tinselCount; i++) {
    const tinsel = document.createElement('div');
    tinsel.classList.add('tinsel');

    // Random horizontal position
    tinsel.style.left = `${Math.random() * 100}%`;

    // Random length
    tinsel.style.height = `${30 + Math.random() * 50}px`;

    // Random swing speed
    tinsel.style.animationDuration = `${1 + Math.random() * 2}s`;

    tinselContainer.appendChild(tinsel);
}
</script>
</body>
</html>
