<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ULTRA Production Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    margin:0;
    padding:15px;
}

h1{
    text-align:center;
}

.card{
    background:#fff;
    border-radius:12px;
    padding:15px;
    margin:12px 0;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.rank{
    background:#ddd;
    border-radius:6px;
    display:inline-block;
    padding:4px 8px;
    font-weight:bold;
    margin-right:10px;
    color:#fff;
}
progress {
    width:100%;
    height:18px;
    border-radius:10px;
    overflow:hidden;
}
progress::-webkit-progress-bar {
    background:#ddd;
    border-radius:10px;
}
progress::-webkit-progress-value {
    background:#2979ff;
    border-radius:10px;
}

input{
    width:80px;
    padding:6px;
    font-size:16px;
}

button {
    padding:7px 12px;
    border-radius:6px;
    border:1px solid #ccc;
    background:#fff;
    font-size:14px;
    cursor:pointer;
}

.lock{
    text-align:center;
    margin-bottom:20px;
}

.lock input{
    width:120px;
    text-align:center;
}

.green{
    color:#009900;
    font-weight:bold;
}

.red{
    color:#cc0000;
    font-weight:bold;
}

.footer{
    text-align:center;
    color:#555;
    margin-top:20px;
}
    .title {
    padding: 5px 10px;
    border-radius: 5px;
    color: white;
    display: inline-block;
    font-size:14px;
}

.blue { background:#2979ff; }
.greenbg { background:#43a047; }
.redbg { background:#e53935; }

.timestamp {
    position: absolute;
    top:8px;
    right:10px;
    font-size:11px;
    color:#666;
}
    .input-row {
    display:flex;
    gap:10px;
    align-items:center;
}
    .card {
    transition:0.15s;
}
.card:hover {
    transform:scale(1.01);
}
    .title {
    padding:8px 14px;
}
   /* ===================== */
/* DARK MODE STYLES */
/* ===================== */

body.dark {
    background:#121212;
    color:#e0e0e0;
}

.dark .card {
    background:#1e1e1e;
    box-shadow:none;
}

.dark input,
.dark button {
    background:#2a2a2a;
    color:white;
    border-color:#555;
}

.dark progress::-webkit-progress-bar {
    background:#333;
}

.dark .timestamp {
    color:#aaa;
}

.dark .percent-label {
    color:#bbb;
} 
    .header{
    display:flex;
    justify-content:space-between;
    align-items:center;
}
#darkToggle{
    font-size:14px;
}
/* ===========================
   CHRISTMAS GARLAND HEADER
   =========================== */

#tinsel-container{
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 180px;
    pointer-events: none;
    z-index: 1000;
}

/* MULTI LINE TINSEL */
.garland-line{
    position: absolute;
    width: 100%;
    height: 6px;
    border-radius: 20px;
    filter: drop-shadow(0 0 6px rgba(255,255,255,0.6));
    background-size: 200% 100%;
    animation: sparkle 2s linear infinite;
}

.red    { background: linear-gradient(90deg, #ff0000, #ffe066); }
.green  { background: linear-gradient(90deg, #00cc44, #ffffff); }
.gold   { background: linear-gradient(90deg, #ffcc00, #fff4b0); }

@keyframes sparkle {
    from { background-position: 0% 0%; }
    to   { background-position: 100% 0%; }
}

/* BAUBLES */
.bauble{
    position: absolute;
    width: 42px;
    height: 52px;
    border-radius: 50%;
    background: radial-gradient(circle at 35% 30%, #ffffff 5%, #ff3366 40%, #aa0022 80%);
    box-shadow: 0 0 12px rgba(0,0,0,0.3) inset;
}

/* STRING */
.string{
    position: absolute;
    width: 2px;
    background: black;
    transform-origin: top;
}

/* INCLUDE SWING */
.swing{
    animation: swing 4s ease-in-out infinite alternate;
}

@keyframes swing {
    0%   { transform: rotate(-8deg); }
    100% { transform: rotate(8deg); }
}
</style>
</head>
    
<body>
    
<div id="tinsel-container"></div>

<div class="header">
    <h1>ULTRA Production Leaderboard</h1>
    <button id="darkToggle" onclick="toggleDark()">ðŸŒ™ Dark Mode</button>
</div>

<div class="lock">
    <h3>Enter PIN to unlock editing</h3>
    <input type="password" id="pinInput" placeholder="4-digit PIN" maxlength="4">
    <button onclick="unlock()">Unlock</button>
</div>

<div id="board"></div>

<div class="footer">
Target: <b>4,000 parts/hr</b> â€¢ Daily target: <b>36,000 parts (9 hours)</b><br>
Live sync across devices enabled.
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ðŸ”¥ YOUR FIREBASE CONFIG */
const firebaseConfig = {
 apiKey: "AIzaSyBjEcJRy9C_WXJYhqLaBEZJ54ZwpEgH8qE",
 authDomain: "ultra-production-board.firebaseapp.com",
 projectId: "ultra-production-board",
 storageBucket: "ultra-production-board.firebasestorage.app",
 messagingSenderId: "1058393515822",
 appId: "1:1058393515822:web:a706cdbc8c02cc0c0e3cbf"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* SETTINGS */
const PIN = "0711";
const TARGET_HOURLY = 4000;
const DAILY_TARGET = 36000;

let unlocked = false;

const teams = [
 {name:"ULTRA1"},
 {name:"ULTRA2"},
 {name:"ULTRA3"}
];

/* UNLOCK */
function unlock(){
   if(document.getElementById("pinInput").value === PIN){
        unlocked = true;
        document.querySelector(".lock").style.display="none";
        loadBoard();
   } else {
        alert("Incorrect PIN");
   }
}

/* LOAD & LIVE SYNC */
function loadBoard(){
   const ref = db.ref("production");
   ref.on("value", snapshot=>{
      const data = snapshot.val() || {};
      renderBoard(data);
   });
}

/* UPDATE DATA */
    function updateTeam(name,value){

    const nowTime = new Date().toLocaleTimeString([], {
        hour: "2-digit",
        minute: "2-digit"
    });

    db.ref("production/"+name).set({
        total: Number(value),
        lastUpdated: nowTime
    });
 }
    function toggleDark(){

    document.body.classList.toggle("dark");

    const mode = document.body.classList.contains("dark") ? "dark" : "light";
    localStorage.setItem("mode", mode);
}
    
/* RENDER */
function renderBoard(data){

   let totals = teams.map(t=>{
        return {name:t.name, total:data[t.name]?.total || 0};
   });

   totals.sort((a,b)=>b.total-a.total);

   let html="";

   totals.forEach((team,idx)=>{
    let percent = Math.min(team.total / DAILY_TARGET *100,100);
    // Calculate expected output based on time of day
const SHIFT_START_HOUR = 9;

const now = new Date();
const shiftStart = new Date();
shiftStart.setHours(SHIFT_START_HOUR,0,0,0);

// Hours worked since 09:00
let elapsedHours = (now - shiftStart) / (1000*60*60);

// Prevent negative numbers before shift starts
elapsedHours = Math.max(0, Math.min(elapsedHours, 9));

// Expected parts so far
let expected = Math.floor(elapsedHours * 4000);

// Difference vs expected at current time
let diff = team.total - expected;
    let diffClass = diff>=0?"green":"red";

    const partsPerMinute = 4000 / 60;
    const minutes = Math.abs(diff) / partsPerMinute;

    let timeLabel = "";

    if(minutes >= 60){
        let h = Math.floor(minutes / 60);
        let m = Math.round(minutes % 60);
        timeLabel = `${h}h ${m}m`;
    } else {
        timeLabel = `${Math.round(minutes)} min`;
    }

    let direction = diff >= 0 ? "Ahead" : "Behind";

    html+=`
    <div class="card" style="position:relative;">
    <div>
        <span class="rank">#${idx+1}</span>
        <span class="title ${team.name==="ULTRA1"?"blue":team.name==="ULTRA2"?"greenbg":"redbg"}">
            ${team.name}
        </span>
    </div>

<div class="input-row">
    <input type="number" id="${team.name}" value="${team.total}" ${unlocked?"":"disabled"}>
    <button onclick="save('${team.name}')" ${unlocked?"":"disabled"}>Update</button>
</div>
    
        <p class="${diffClass}">
            ${direction} by ${Math.abs(diff)} parts<br>
            (â‰ˆ ${timeLabel} ${direction.toLowerCase()})
        </p>
        
<p class="timestamp">
    Last update: ${data[team.name]?.lastUpdated || "--"}
</p>

        <progress value="${percent}" max="100"></progress>

        <p>${team.total} parts</p>
    </div>
    `;
});
    
   document.getElementById("board").innerHTML = html;
}

function save(name){
    let val = document.getElementById(name).value;
    updateTeam(name,val);
}
    if(localStorage.getItem("mode")==="dark"){
    document.body.classList.add("dark");
}
</script>

<script>
document.addEventListener("DOMContentLoaded", () => {

    const container = document.getElementById("tinsel-container");

    /* ===== CREATE WAVY TINSEL LINES ===== */

    function createGarland(top, colorClass, sag){
        const segments = 30;
        const containerWidth = container.offsetWidth;

        for(let i = 0; i < segments; i++){
            const line = document.createElement("div");
            line.classList.add("garland-line", colorClass);

            const left = (i / segments) * 100;
            const wave = Math.sin((i / segments) * Math.PI * 2) * sag;

            line.style.top = top + wave + "px";
            line.style.left = left + "%";
            line.style.width = (100 / segments) + "%";

            container.appendChild(line);
        }
    }

    /* THREE LAYERS LIKE YOUR SKETCH */
    createGarland(30, "red",   20);
    createGarland(55, "green", 25);
    createGarland(80, "gold",  30);

    /* ===== CREATE BAUBLES & STRINGS ===== */

    const baubleColors = [
        "radial-gradient(circle at 35% 30%, #ffffff 5%, #ff3366 40%, #aa0022 80%)",
        "radial-gradient(circle at 35% 30%, #ffffff 5%, #6a5acd 40%, #2a1873 80%)",
        "radial-gradient(circle at 35% 30%, #ffffff 5%, #f4b400 40%, #a36c00 80%)"
    ];

    const baubleCount = 7;

    for(let i=0;i<baubleCount;i++){

        const x = 10 + i * (80 / baubleCount);
        const drop = 100 + Math.random()*25;

        const string = document.createElement("div");
        string.className = "string swing";
        string.style.left = x + "%";
        string.style.top = "0";
        string.style.height = drop + "px";

        const bauble = document.createElement("div");
        bauble.className = "bauble swing";
        bauble.style.left = `calc(${x}% - 20px)`;
        bauble.style.top = drop + "px";

        bauble.style.background =
            baubleColors[Math.floor(Math.random()*baubleColors.length)];

        /* varying swing timing */
        const swingSpeed = 3 + Math.random()*2;
        bauble.style.animationDuration = swingSpeed + "s";
        string.style.animationDuration = swingSpeed + "s";

        container.appendChild(string);
        container.appendChild(bauble);
    }

});
</script>
</body>
</html>
