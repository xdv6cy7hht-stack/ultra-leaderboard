<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>ULTRA Production Leaderboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    font-family: Arial, sans-serif;
    background:#f4f6f8;
    margin:0;
    padding:15px;
}

h1{
    text-align:center;
}

.card{
    background:#fff;
    border-radius:12px;
    padding:15px;
    margin:12px 0;
    box-shadow:0 2px 6px rgba(0,0,0,0.1);
}

.rank{
    background:#ddd;
    border-radius:6px;
    display:inline-block;
    padding:4px 8px;
    font-weight:bold;
    margin-right:10px;
}

progress{
    width:100%;
    height:20px;
}

input{
    width:80px;
    padding:6px;
    font-size:16px;
}

button{
    padding:6px 12px;
    font-size:16px;
}

.lock{
    text-align:center;
    margin-bottom:20px;
}

.lock input{
    width:120px;
    text-align:center;
}

.green{
    color:#009900;
    font-weight:bold;
}

.red{
    color:#cc0000;
    font-weight:bold;
}

.footer{
    text-align:center;
    color:#555;
    margin-top:20px;
}
</style>
</head>

<body>

<h1>ULTRA Production Leaderboard</h1>

<div class="lock">
    <h3>Enter PIN to unlock editing</h3>
    <input type="password" id="pinInput" placeholder="4-digit PIN" maxlength="4">
    <button onclick="unlock()">Unlock</button>
</div>

<div id="board"></div>

<div class="footer">
Target: <b>4,000 parts/hr</b> â€¢ Daily target: <b>36,000 parts (9 hours)</b><br>
Live sync across devices enabled.
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
/* ðŸ”¥ YOUR FIREBASE CONFIG */
const firebaseConfig = {
 apiKey: "AIzaSyBjEcJRy9C_WXJYhqLaBEZJ54ZwpEgH8qE",
 authDomain: "ultra-production-board.firebaseapp.com",
 projectId: "ultra-production-board",
 storageBucket: "ultra-production-board.firebasestorage.app",
 messagingSenderId: "1058393515822",
 appId: "1:1058393515822:web:a706cdbc8c02cc0c0e3cbf"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

/* SETTINGS */
const PIN = "0711";
const TARGET_HOURLY = 4000;
const DAILY_TARGET = 36000;

let unlocked = false;

const teams = [
 {name:"ULTRA1"},
 {name:"ULTRA2"},
 {name:"ULTRA3"}
];

/* UNLOCK */
function unlock(){
   if(document.getElementById("pinInput").value === PIN){
        unlocked = true;
        document.querySelector(".lock").style.display="none";
        loadBoard();
   } else {
        alert("Incorrect PIN");
   }
}

/* LOAD & LIVE SYNC */
function loadBoard(){
   const ref = db.ref("production");
   ref.on("value", snapshot=>{
      const data = snapshot.val() || {};
      renderBoard(data);
   });
}

/* UPDATE DATA */
function updateTeam(name,value){
   db.ref("production/"+name).set({
      total: Number(value),
      time: Date.now()
   });
}

/* RENDER */
function renderBoard(data){

   let totals = teams.map(t=>{
        return {name:t.name, total:data[t.name]?.total || 0};
   });

   totals.sort((a,b)=>b.total-a.total);

   let html="";

   totals.forEach((team,idx)=>{
    let percent = Math.min(team.total / DAILY_TARGET *100,100);
    let diff = team.total - DAILY_TARGET;
    let diffClass = diff>=0?"green":"red";

    const partsPerMinute = 4000 / 60;
    const minutes = Math.abs(diff) / partsPerMinute;

    let timeLabel = "";

    if(minutes >= 60){
        let h = Math.floor(minutes / 60);
        let m = Math.round(minutes % 60);
        timeLabel = `${h}h ${m}m`;
    } else {
        timeLabel = `${Math.round(minutes)} min`;
    }

    let direction = diff >= 0 ? "Ahead" : "Behind";

    html+=`
    <div class="card">
        <div>
            <span class="rank">#${idx+1}</span>
            <b>${team.name}</b>
        </div><br>

        <input type="number" id="${team.name}" value="${team.total}" ${unlocked?"":"disabled"}>
        <button onclick="save('${team.name}')" ${unlocked?"":"disabled"}>Update</button>
        
        <p class="${diffClass}">
            ${direction} by ${Math.abs(diff)} parts<br>
            (â‰ˆ ${timeLabel} ${direction.toLowerCase()})
        </p>

        <progress value="${percent}" max="100"></progress>

        <p>${team.total} parts</p>
    </div>
    `;
});
    
   document.getElementById("board").innerHTML = html;
}

function save(name){
    let val = document.getElementById(name).value;
    updateTeam(name,val);
}
</script>

</body>
</html>
